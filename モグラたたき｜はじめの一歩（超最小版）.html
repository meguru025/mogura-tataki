<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ¢ã‚°ãƒ©ãŸãŸã - ã¯ã˜ã‚ã®ä¸€æ­©</title>
  <style>
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; margin:0; background:#0b1220; color:#e5e7eb; display:grid; place-items:center; min-height:100vh}
    .app{max-width:560px; width:92vw}
    h1{font-size:1.25rem; margin:20px 0 8px}
    .bar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .stat{background:#111827; padding:6px 10px; border-radius:10px}
    button{cursor:pointer; border:none; border-radius:10px; padding:8px 14px; font-weight:700; background:#22c55e; color:#062a12}
    .board{margin-top:14px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
    .hole{position:relative; height:120px; border-radius:12px; background:#1f2937; overflow:hidden}
    .mole{position:absolute; left:50%; bottom:-80%; transform:translateX(-50%); width:70px; height:70px; border-radius:50%; background:#f59e0b; display:grid; place-items:center; transition:bottom .12s ease-out}
    .mole.up{bottom:10%}
  </style>
</head>
<body>
  <div class="app">
    <h1>ãƒ¢ã‚°ãƒ©ãŸãŸãï¼ˆæœ€å°å‹•ä½œï¼‰</h1>
    <div class="bar">
      <div class="stat">ã‚¹ã‚³ã‚¢: <b id="score">0</b></div>
      <div class="stat">æ®‹ã‚Š: <b id="time">20</b>s</div>
      <button id="start">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
    <div id="board" class="board" aria-label="ç©´ã®ã‚°ãƒªãƒƒãƒ‰"></div>
  </div>

  <script>
    // ===== 1. å¤‰æ•°ã®ç”¨æ„ =====
    const HOLES = 9;               // ç©´ã®æ•°ï¼ˆ3x3ï¼‰
    const GAME_SECONDS = 20;       // åˆ¶é™æ™‚é–“ï¼ˆçŸ­ã‚ï¼‰
    const UP_TIME = 800;           // ãƒ¢ã‚°ãƒ©ã®è¡¨ç¤ºæ™‚é–“(ms)
    const GAP_TIME = 500;          // æ¬¡ã®å‡ºç¾ã¾ã§ã®é–“éš”(ms)

    const board = document.getElementById('board');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');
    const startBtn = document.getElementById('start');

    let score = 0;
    let timeLeft = GAME_SECONDS;
    let running = false;
    let countdown = null;  // setInterval ã®ID
    let spawner = null;    // setTimeout ã®ID

    // ===== 2. ç›¤é¢ã‚’ä½œã‚‹ï¼ˆç©´ï¼‹ãƒ¢ã‚°ãƒ©ï¼‰ =====
    function createBoard(){
      board.innerHTML = '';
      for(let i=0;i<HOLES;i++){
        const hole = document.createElement('button');
        hole.type = 'button';
        hole.className = 'hole';

        const mole = document.createElement('div');
        mole.className = 'mole';
        mole.textContent = 'ğŸ¹';
        hole.appendChild(mole);

        // ã‚¯ãƒªãƒƒã‚¯ã§å½“ãŸã‚Šåˆ¤å®š
        hole.addEventListener('click', () => {
          if(!running) return;
          if(mole.classList.contains('up')){
            score++;
            scoreEl.textContent = score;
            mole.classList.remove('up'); // å©ã„ãŸã‚‰å¼•ã£è¾¼ã‚€
          }
        });

        board.appendChild(hole);
      }
    }

    // ===== 3. ã‚²ãƒ¼ãƒ ã®å‹•ã =====
    const rand = (min, max) => Math.floor(Math.random()*(max-min+1))+min;

    function showOneMole(){
      const holes = board.querySelectorAll('.hole');
      const idx = rand(0, holes.length-1);
      const mole = holes[idx].querySelector('.mole');
      mole.classList.add('up');
      setTimeout(()=> mole.classList.remove('up'), UP_TIME);
    }

    function loopSpawn(){
      if(!running) return;
      showOneMole();
      spawner = setTimeout(loopSpawn, GAP_TIME);
    }

    function startGame(){
      if(running) return;
      running = true;
      score = 0; scoreEl.textContent = score;
      timeLeft = GAME_SECONDS; timeEl.textContent = timeLeft;

      // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
      countdown = setInterval(() => {
        timeLeft--; timeEl.textContent = timeLeft;
        if(timeLeft <= 0){ endGame(); }
      }, 1000);

      // å‡ºç¾ãƒ«ãƒ¼ãƒ—é–‹å§‹
      loopSpawn();
    }

    function endGame(){
      running = false;
      clearInterval(countdown);
      clearTimeout(spawner);
      alert(`çµ‚äº†ï¼ ã‚¹ã‚³ã‚¢: ${score}`);
    }

    // ===== 4. åˆæœŸåŒ–ã¨é–‹å§‹ãƒœã‚¿ãƒ³ =====
    createBoard();
    startBtn.addEventListener('click', startGame);
  </script>
</body>
</html>
