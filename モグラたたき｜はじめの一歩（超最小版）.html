<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>モグラたたき - はじめの一歩</title>
  <style>
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; margin:0; background:#0b1220; color:#e5e7eb; display:grid; place-items:center; min-height:100vh}
    .app{max-width:560px; width:92vw}
    h1{font-size:1.25rem; margin:20px 0 8px}
    .bar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .stat{background:#111827; padding:6px 10px; border-radius:10px}
    button{cursor:pointer; border:none; border-radius:10px; padding:8px 14px; font-weight:700; background:#22c55e; color:#062a12}
    .board{margin-top:14px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
    .hole{position:relative; height:120px; border-radius:12px; background:#1f2937; overflow:hidden}
    .mole{position:absolute; left:50%; bottom:-80%; transform:translateX(-50%); width:70px; height:70px; border-radius:50%; background:#f59e0b; display:grid; place-items:center; transition:bottom .12s ease-out}
    .mole.up{bottom:10%}
  </style>
</head>
<body>
  <div class="app">
    <h1>モグラたたき（最小動作）</h1>
    <div class="bar">
      <div class="stat">スコア: <b id="score">0</b></div>
      <div class="stat">残り: <b id="time">20</b>s</div>
      <button id="start">スタート</button>
    </div>
    <div id="board" class="board" aria-label="穴のグリッド"></div>
  </div>

  <script>
    // ===== 1. 変数の用意 =====
    const HOLES = 9;               // 穴の数（3x3）
    const GAME_SECONDS = 20;       // 制限時間（短め）
    const UP_TIME = 800;           // モグラの表示時間(ms)
    const GAP_TIME = 500;          // 次の出現までの間隔(ms)

    const board = document.getElementById('board');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');
    const startBtn = document.getElementById('start');

    let score = 0;
    let timeLeft = GAME_SECONDS;
    let running = false;
    let countdown = null;  // setInterval のID
    let spawner = null;    // setTimeout のID

    // ===== 2. 盤面を作る（穴＋モグラ） =====
    function createBoard(){
      board.innerHTML = '';
      for(let i=0;i<HOLES;i++){
        const hole = document.createElement('button');
        hole.type = 'button';
        hole.className = 'hole';

        const mole = document.createElement('div');
        mole.className = 'mole';
        mole.textContent = '🐹';
        hole.appendChild(mole);

        // クリックで当たり判定
        hole.addEventListener('click', () => {
          if(!running) return;
          if(mole.classList.contains('up')){
            score++;
            scoreEl.textContent = score;
            mole.classList.remove('up'); // 叩いたら引っ込む
          }
        });

        board.appendChild(hole);
      }
    }

    // ===== 3. ゲームの動き =====
    const rand = (min, max) => Math.floor(Math.random()*(max-min+1))+min;

    function showOneMole(){
      const holes = board.querySelectorAll('.hole');
      const idx = rand(0, holes.length-1);
      const mole = holes[idx].querySelector('.mole');
      mole.classList.add('up');
      setTimeout(()=> mole.classList.remove('up'), UP_TIME);
    }

    function loopSpawn(){
      if(!running) return;
      showOneMole();
      spawner = setTimeout(loopSpawn, GAP_TIME);
    }

    function startGame(){
      if(running) return;
      running = true;
      score = 0; scoreEl.textContent = score;
      timeLeft = GAME_SECONDS; timeEl.textContent = timeLeft;

      // カウントダウン
      countdown = setInterval(() => {
        timeLeft--; timeEl.textContent = timeLeft;
        if(timeLeft <= 0){ endGame(); }
      }, 1000);

      // 出現ループ開始
      loopSpawn();
    }

    function endGame(){
      running = false;
      clearInterval(countdown);
      clearTimeout(spawner);
      alert(`終了！ スコア: ${score}`);
    }

    // ===== 4. 初期化と開始ボタン =====
    createBoard();
    startBtn.addEventListener('click', startGame);
  </script>
</body>
</html>
